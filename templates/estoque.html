<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Estoque - N7</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estoque.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <header class="main-header">
        <div class="back-button-container">
            <a href="{{ url_for('index', farm_id=farm_id) }}" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Voltar para o Início
            </a>
        </div>
        <div class="header-content">
            <div class="header-left">
                <div class="logo-container">
                    <i class="fas fa-warehouse header-icon"></i>
                    <div>
                        <h1>Sistema Frutos Do Vale</h1>
                        <p class="subtitle">Gestão Inteligente de Estoque</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="date-display">
                    <i class="far fa-calendar-alt"></i>
                    <span id="current-date"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Dashboard -->
    <section class="stats-dashboard">
        <div class="stats-container">
            <div class="stat-card produtos-stat">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-produtos">-</h3>
                    <p>Produtos Ativos</p>
                </div>
            </div>
            
            <div class="stat-card movimentacoes-stat">
                <div class="stat-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-movimentacoes">-</h3>
                    <p>Movimentações Hoje</p>
                </div>
            </div>
            
            <div class="stat-card valor-stat">
                <div class="stat-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-content">
                    <h3 id="valor-total">R$ -</h3>
                    <p>Valor Total Estoque</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Quick Actions Section -->
        <section class="quick-actions">
            <h2 class="section-title">
                <i class="fas fa-bolt"></i>
                Ações Rápidas
            </h2>
            
            <div class="action-cards">
                <!-- Card de Registro Melhorado -->
                <div class="action-card primary-card" id="registroCard">
                    <div class="card-background">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3>Registrar Movimento</h3>
                    </div>
                    <div class="card-content">
                        <p>Registre entrada ou saída de produtos com facilidade</p>
                        <div class="card-stats">
                            <div class="mini-stat">
                                <span class="mini-stat-number" id="entradas-hoje">0</span>
                                <span class="mini-stat-label">Entradas hoje</span>
                            </div>
                            <div class="mini-stat">
                                <span class="mini-stat-number" id="saidas-hoje">0</span>
                                <span class="mini-stat-label">Saídas hoje</span>
                            </div>
                        </div>
                    </div>
                    <button class="card-button primary-button" onclick="showModal('registroModal')">
                        <span>Registrar Agora</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>

                <!-- Card de Adicionar Produto -->
                <div class="action-card success-card" id="addProdutoCard">
                    <div class="card-background">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <h3>Novo Produto</h3>
                    </div>
                    <div class="card-content">
                        <p>Adicione novos produtos ao catálogo do estoque</p>
                        <div class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                            <span>75% categorias preenchidas</span>
                        </div>
                    </div>
                    <button class="card-button success-button" onclick="showModal('addProdutoModal')">
                        <span>Adicionar</span>
                        <i class="fas fa-plus"></i>
                    </button>
                </div>

                <!-- Card de Remover Produto -->
                <div class="action-card warning-card" id="removeProdutoCard">
                    <div class="card-background">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-trash-alt"></i>
                        </div>
                        <h3>Gerenciar Produtos</h3>
                    </div>
                    <div class="card-content">
                        <p>Desative produtos não utilizados do sistema</p>
                        <div class="card-alert">
                            <i class="fas fa-info-circle"></i>
                            <span>Produtos inativos: <strong id="inativos-count">0</strong></span>
                        </div>
                    </div>
                    <button class="card-button warning-button" onclick="showModal('removeProdutoModal')">
                        <span>Gerenciar</span>
                        <i class="fas fa-cog"></i>
                    </button>
                </div>

                <!-- Card de Adicionar Loja -->
                <div class="action-card info-card" id="addLojaCard">
                    <div class="card-background">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <h3>Nova Loja</h3>
                    </div>
                    <div class="card-content">
                        <p>Cadastre novos pontos de venda</p>
                        <div class="card-list">
                            <div class="list-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Lojas ativas: <strong id="lojas-ativas">0</strong></span>
                            </div>
                        </div>
                    </div>
                    <button class="card-button info-button" onclick="showModal('addLojaModal')">
                        <span>Adicionar</span>
                        <i class="fas fa-store"></i>
                    </button>
                </div>

                <!-- Card de Remover Loja -->
                <div class="action-card danger-card" id="removeLojaCard">
                    <div class="card-background">
                        <i class="fas fa-store-slash"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-store-slash"></i>
                        </div>
                        <h3>Remover Loja</h3>
                    </div>
                    <div class="card-content">
                        <p>Excluir lojas que não estão mais ativas</p>
                        <div class="card-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Ação irreversível</span>
                        </div>
                    </div>
                    <button class="card-button danger-button" onclick="showModal('removeLojaModal')">
                        <span>Remover</span>
                        <i class="fas fa-trash"></i>
                    </button>
                </div>

                <!-- Card de Download -->
                <div class="action-card purple-card" id="downloadCard">
                    <div class="card-background">
                        <i class="fas fa-cloud-download-alt"></i>
                    </div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-cloud-download-alt"></i>
                        </div>
                        <h3>Relatórios</h3>
                    </div>
                    <div class="card-content">
                        <p>Baixe relatórios completos do estoque</p>
                        <div class="card-list">
                            <div class="list-item">
                                <i class="fas fa-file-excel"></i>
                                <span>Excel, PDF, CSV</span>
                            </div>
                        </div>
                    </div>
                    <button class="card-button purple-button" onclick="showModal('downloadModal')">
                        <span>Download</span>
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- Recent Activity Section -->
        <section class="recent-activity">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-history"></i>
                    Movimentações Recentes
                </h2>
                <button class="view-all-btn" onclick="showModal('registroModal')">
                    <span>Ver Todas</span>
                    <i class="fas fa-external-link-alt"></i>
                </button>
            </div>
            <div class="activity-grid">
                <div id="recent-movements" class="movement-cards">
                    <!-- Movimentações serão carregadas via JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- MODAIS (mantendo a estrutura existente mas com classes melhoradas) -->
    
    <!-- Modal de Registro de Estoque -->
    <div id="registroModal" class="modal modern-modal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-clipboard-list"></i>
                    Registrar Movimentação de Estoque
                </h3>
                <button class="close-modal" onclick="closeModal('registroModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="form-section">
                    <form id="registroForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="data">
                                    <i class="fas fa-calendar"></i>
                                    Data
                                </label>
                                <input type="date" id="data" name="data" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="tipo_movimento">
                                    <i class="fas fa-exchange-alt"></i>
                                    Tipo de Movimento
                                </label>
                                <select id="tipo_movimento" name="tipo_movimento" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="ENTRADA">🔼 Entrada</option>
                                    <option value="SAIDA">🔽 Saída</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="produto">
                                    <i class="fas fa-box"></i>
                                    Produto
                                </label>
                                <select id="produto" name="produto_id" required>
                                    <option value="">Selecione o produto</option>
                                </select>
                                <div id="classificacaoProduto" class="product-classification" style="display: none;">
                                    <span class="classification-badge">
                                        <i class="fas fa-tag"></i>
                                        <span id="classificationText"></span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="quantidade">
                                    <i class="fas fa-sort-numeric-up"></i>
                                    Quantidade
                                </label>
                                <input type="number" id="quantidade" name="quantidade" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="valor_unitario">
                                    <i class="fas fa-dollar-sign"></i>
                                    Valor Unitário
                                </label>
                                <input type="number" id="valor_unitario" name="valor_unitario" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="funcionario">
                                    <i class="fas fa-user"></i>
                                    Funcionário
                                </label>
                                <select id="funcionario" name="funcionario_id" required>
                                    <option value="">Selecione um funcionário</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="loja">
                                    <i class="fas fa-store"></i>
                                    Loja
                                </label>
                                <select id="loja" name="loja_id" required>
                                    <option value="">Selecione uma loja</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-buttons">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i>
                                Registrar Movimentação
                            </button>
                            <button type="button" class="btn-secondary" onclick="closeModal('registroModal')">
                                <i class="fas fa-times"></i>
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="recent-section">
                    <div class="section-header">
                        <h4>
                            <i class="fas fa-clock"></i>
                            Últimas Movimentações
                        </h4>
                    </div>
                    <div id="movimentacoes-list" class="movements-list">
                        <!-- Movimentações serão carregadas via JavaScript -->
                    </div>
                    <div class="pagination">
                        <!-- Paginação será inserida via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Adicionar Produto -->
    <div id="addProdutoModal" class="modal modern-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-plus-circle"></i>
                    Adicionar Novo Produto
                </h3>
                <button class="close-modal" onclick="closeModal('addProdutoModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="addProdutoForm">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="nomeProduto">
                                <i class="fas fa-box"></i>
                                Nome do Produto
                            </label>
                            <input type="text" id="nomeProduto" name="nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="tipoProduto">
                                <i class="fas fa-weight"></i>
                                Tipo/Unidade
                            </label>
                            <select id="tipoProduto" name="tipo" required>
                                <option value="">Selecione o tipo</option>
                                <option value="KG">KG - Quilograma</option>
                                <option value="L">L - Litro</option>
                                <option value="UN">UN - Unidade</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="classificacaoProduto">
                                <i class="fas fa-tag"></i>
                                Classificação
                            </label>
                            <select id="classificacaoProduto" name="classificacao" required>
                                <option value="">Selecione a classificação</option>
                                <option value="FERTILIZANTE">Fertilizante</option>
                                <option value="DEFENSIVOS">Defensivos</option>
                                <option value="EMBALAGEM">Embalagem</option>
                                <option value="ESPALHANTE">Espalhante</option>
                                <option value="FOLIAR">Foliar</option>
                                <option value="HORMONAL">Hormonal</option>
                                <option value="PEÇAS">Peças</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i>
                            Adicionar Produto
                        </button>
                        <button type="button" class="btn-secondary" onclick="closeModal('addProdutoModal')">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Remover Produto -->
    <div id="removeProdutoModal" class="modal modern-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-trash-alt"></i>
                    Gerenciar Produtos
                </h3>
                <button class="close-modal" onclick="closeModal('removeProdutoModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="search-section">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchProduto" placeholder="Buscar produto...">
                    </div>
                </div>
                
                <div id="listaProdutos" class="products-list">
                    <!-- Lista de produtos será carregada via JavaScript -->
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de Adicionar Loja -->
    <div id="addLojaModal" class="modal modern-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-store"></i>
                    Adicionar Nova Loja
                </h3>
                <button class="close-modal" onclick="closeModal('addLojaModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="addLojaForm">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="nomeLoja">
                                <i class="fas fa-store"></i>
                                Nome da Loja
                            </label>
                            <input type="text" id="nomeLoja" name="nome" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="telefoneLoja">
                                <i class="fas fa-phone"></i>
                                Telefone
                            </label>
                            <input type="text" id="telefoneLoja" name="telefone" placeholder="(87) 99999-9999">
                        </div>
                        
                        <div class="form-group">
                            <label for="vendedorLoja">
                                <i class="fas fa-user-tie"></i>
                                Vendedor
                            </label>
                            <input type="text" id="vendedorLoja" name="vendedor">
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i>
                            Adicionar Loja
                        </button>
                        <button type="button" class="btn-secondary" onclick="closeModal('addLojaModal')">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Remover Loja -->
    <div id="removeLojaModal" class="modal modern-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-store-slash"></i>
                    Gerenciar Lojas
                </h3>
                <button class="close-modal" onclick="closeModal('removeLojaModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="listaLojas" class="lojas-list">
                    <!-- Lista de lojas será carregada via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Download -->
    <div id="downloadModal" class="modal modern-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>
                    <i class="fas fa-download"></i>
                    Download de Relatórios
                </h3>
                <button class="close-modal" onclick="closeModal('downloadModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="download-options">
                    <h4>Escolha o tipo de relatório:</h4>
                    
                    <div class="download-grid">
                        <button class="download-option" onclick="downloadPlanilha('completo')">
                            <i class="fas fa-file-excel"></i>
                            <span>Relatório Completo</span>
                            <small>Todas as movimentações</small>
                        </button>
                        
                        <button class="download-option" onclick="downloadPlanilha('resumo')">
                            <i class="fas fa-chart-pie"></i>
                            <span>Resumo do Estoque</span>
                            <small>Saldo atual por produto</small>
                        </button>
                        
                        <button class="download-option" onclick="downloadPlanilha('mensal')">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Relatório Mensal</span>
                            <small>Movimentações do mês</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p>Sistema Frutos Do Vale © <span id="current-year"></span></p>
                <p class="footer-subtitle">Gestão Inteligente de Estoque</p>
            </div>
            <div class="footer-right">
                <div class="footer-links">
                    <a href="javascript:void(0)" onclick="mostrarEmailSuporte()">
                        <i class="fas fa-headset"></i>
                        Suporte
                    </a>
                    <a href="#">
                        <i class="fas fa-book"></i>
                        Documentação
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/estoque.js') }}"></script>
</body>
</html>